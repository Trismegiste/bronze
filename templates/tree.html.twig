{% extends "base.html.twig" %}

{% block main %}
    <div x-data="familyTree">
        <template x-for="level in families">
            <div class="pure-g" x-html="renderLevel(level)"></li>
        </template>
        <button x-on:click="update" ond>Update</button>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('familyTree', () => ({
                    families: [
                        {
                            name: 'Lupe',
                            children: [
                                {
                                    name: 'Bertha',
                                    children: [
                                        {
                                            name: 'Hollywood',
                                        },
                                        {
                                            name: 'Yolo',
                                        },
                                    ],
                                },
                                {
                                    name: 'Pinnick',
                                    children: [
                                        {
                                            name: 'Andy',
                                            children: [
                                                {
                                                    name: 'Arffff'
                                                }
                                            ]
                                        },
                                    ]
                                },
                            ]
                        },
                        {
                            name: 'Smitty',
                            children: [
                                {
                                    name: 'Vito',
                                    children: []
                                },
                                {
                                    name: 'Danny',
                                    children: []
                                },
                                {
                                    name: 'Penguin',
                                    children: []
                                },
                            ],
                        }
                    ],

                    renderLevel(obj) {
                        let html = `<div class="pure-u-1-12"></div>
                                <div class="pure-u-11-12" draggable="true">
                                    <span x-text="level.name"></span>`

                        if (obj.children && obj.children.length) {
                            html += `<template x-for="level in level.children">
                                            <div class="pure-g" x-html="renderLevel(level)"></div>
                                    </template>`
                        }

                        html += '</div>'

                        html += `<div class="pure-u-1-12"></div>
                                <div class="pure-u-11-12 sortingzone"
                                    x-on:dragenter="enterSortingZone"
                                    x-on:dragleave="leaveSortingZone"
                                    x-on:dragover="dragOverNothing"
                                    x-on:drop="dropSortingZone">
                                </div>`

                        return html
                    },

                    enterSortingZone(event) {
                        if (event.target.classList.contains("sortingzone")) {
                            event.target.classList.add("focusedzone")
                        }
                    },

                    leaveSortingZone(event) {
                        if (event.target.classList.contains("sortingzone")) {
                            event.target.classList.remove("focusedzone")
                        }
                    },

                    update() {
                        this.families.push({name: 'toto', children: []})
                    },

                    dragOverNothing(event) {
                        // prevent default to allow drop
                        event.preventDefault()
                    },

                    dropSortingZone(event) {
                        event.preventDefault()
                        console.log(event)
                    }
                }))
        })
    </script>
{% endblock %}

{% block stylesheets %}
    <style>
        div {
            background-color: hsl(0deg 50% 50% / 20%)
        }
        .sortingzone {
            height: 0.5em;
        }
        .focusedzone {
            background-color: green;
        }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css" integrity="sha384-X38yfunGUhNzHpBaEBsWLO+A0HDYOQi8ufWDkZ0k9e0eXz/tH3II7uKZ9msv++Ls" crossorigin="anonymous">
{% endblock %}